<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Admin - Torneo Hefrot</title>
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #1a1f2e;
            --accent-primary: #00d9ff;
            --accent-secondary: #0099cc;
            --text-primary: #e8eaed;
            --text-secondary: #9aa0a6;
            --border-color: rgba(0, 217, 255, 0.3);
            --success: #10b981;
            --error: #ef4444;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* ===== LOGIN SCREEN ===== */
        #login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .login-box {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 3rem;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.4s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-box h1 {
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--accent-primary);
            font-size: 2rem;
        }
        
        .login-box p {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        
        .login-box input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        
        .login-box input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
        }
        
        .login-box button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: var(--bg-primary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .login-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 217, 255, 0.4);
        }
        
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--error);
            color: var(--error);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
            margin-top: 1rem;
            display: none;
            animation: shake 0.4s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* ===== ADMIN CONTENT ===== */
        #admin-content {
            display: none;
            min-height: 100vh;
        }
        
        .header {
            background: var(--bg-secondary);
            padding: 1.5rem 2rem;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: var(--accent-primary);
            font-size: 1.5rem;
        }
        
        .logout-btn {
            padding: 0.6rem 1.5rem;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--error);
            color: var(--error);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: var(--error);
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .form-section {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-section h2 {
            color: var(--accent-primary);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .form-group input, .form-group select {
            padding: 0.75rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        .btn-primary {
            padding: 0.75rem 2rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: var(--bg-primary);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        
        .status-message {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
        }
        
        .status-message.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .status-message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--error);
            color: var(--error);
        }
    </style>
</head>
<body>
    <!-- ===== LOGIN SCREEN ===== -->
    <div id="login-screen">
        <div class="login-box">
            <h1>üîê Admin Panel</h1>
            <p>Torneo Hefrot 2025</p>
            <form id="login-form">
                <input 
                    type="password" 
                    id="password" 
                    placeholder="Ingresa la contrase√±a" 
                    autocomplete="off"
                    autofocus 
                    required
                >
                <button type="submit">üîì Acceder</button>
                <div class="error" id="error-msg">‚ùå Contrase√±a incorrecta</div>
            </form>
        </div>
    </div>

    <!-- ===== ADMIN CONTENT ===== -->
    <div id="admin-content">
        <header class="header">
            <h1>‚öΩ Panel de Administraci√≥n - Torneo Hefrot</h1>
            <button class="logout-btn" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
        </header>

        <div class="container">
            <!-- REGISTRAR PARTIDO -->
            <section class="form-section">
                <h2>üìù Registrar Nuevo Partido</h2>
                <form id="partido-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Equipo Local</label>
                            <select id="equipo-local" required>
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Goles Local</label>
                            <input type="number" id="goles-local" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Equipo Visitante</label>
                            <select id="equipo-visitante" required>
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Goles Visitante</label>
                            <input type="number" id="goles-visitante" min="0" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">‚úÖ Registrar Partido</button>
                    <div id="status-partido" class="status-message"></div>
                </form>
            </section>

            <!-- REGISTRAR GOLEADOR -->
            <section class="form-section">
                <h2>‚öΩ Registrar Goleador</h2>
                <form id="goleador-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombre del Jugador</label>
                            <input type="text" id="nombre-goleador" required>
                        </div>
                        <div class="form-group">
                            <label>Equipo</label>
                            <select id="equipo-goleador" required>
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cantidad de Goles</label>
                            <input type="number" id="cantidad-goles" min="1" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">‚úÖ Registrar Goles</button>
                    <div id="status-goleador" class="status-message"></div>
                </form>
            </section>
        </div>
    </div>

    <script>
        // ===== CONFIGURACI√ìN =====
        const ADMIN_PASSWORD = 'hefrot2025';
        const REPO = 'hefrot/torneo-hefrot';
        const BRANCH = 'main';
        const TOKEN = 'ghp_5sO7Nxpo6G2H1AEMZMTrPsONp1HWMM2EqXNY';

        // ===== LOGIN =====
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('admin_auth', 'true');
                showAdmin();
            } else {
                const errorMsg = document.getElementById('error-msg');
                errorMsg.style.display = 'block';
                document.getElementById('password').value = '';
                setTimeout(() => errorMsg.style.display = 'none', 3000);
            }
        });

        function showAdmin() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            cargarEquipos();
        }

        function logout() {
            sessionStorage.removeItem('admin_auth');
            location.reload();
        }

        // Verificar si ya est√° logueado
        if (sessionStorage.getItem('admin_auth') === 'true') {
            showAdmin();
        }

        // ===== FUNCIONES PRINCIPALES =====
        async function cargarEquipos() {
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO}/contents/equipos.json?ref=${BRANCH}`, {
                    headers: { 'Authorization': `token ${TOKEN}` }
                });
                const data = await response.json();
                const equipos = JSON.parse(atob(data.content));

                const selects = ['equipo-local', 'equipo-visitante', 'equipo-goleador'];
                selects.forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Seleccionar...</option>';
                    equipos.forEach(eq => {
                        select.innerHTML += `<option value="${eq.nombre}">${eq.nombre}</option>`;
                    });
                });
            } catch (error) {
                console.error('Error cargando equipos:', error);
            }
        }

        // REGISTRAR PARTIDO
        document.getElementById('partido-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const local = document.getElementById('equipo-local').value;
            const golesLocal = parseInt(document.getElementById('goles-local').value);
            const visitante = document.getElementById('equipo-visitante').value;
            const golesVisitante = parseInt(document.getElementById('goles-visitante').value);

            if (local === visitante) {
                mostrarStatus('status-partido', 'Un equipo no puede jugar contra s√≠ mismo', 'error');
                return;
            }

            try {
                const response = await fetch(`https://api.github.com/repos/${REPO}/contents/equipos.json?ref=${BRANCH}`, {
                    headers: { 'Authorization': `token ${TOKEN}` }
                });
                const data = await response.json();
                let equipos = JSON.parse(atob(data.content));

                equipos = equipos.map(eq => {
                    if (eq.nombre === local) {
                        eq.pj++;
                        eq.gf += golesLocal;
                        eq.gc += golesVisitante;
                        if (golesLocal > golesVisitante) { eq.pg++; eq.pts += 3; }
                        else if (golesLocal === golesVisitante) { eq.pe++; eq.pts += 1; }
                        else { eq.pp++; }
                    }
                    if (eq.nombre === visitante) {
                        eq.pj++;
                        eq.gf += golesVisitante;
                        eq.gc += golesLocal;
                        if (golesVisitante > golesLocal) { eq.pg++; eq.pts += 3; }
                        else if (golesVisitante === golesLocal) { eq.pe++; eq.pts += 1; }
                        else { eq.pp++; }
                    }
                    eq.dif = eq.gf - eq.gc;
                    return eq;
                });

                await fetch(`https://api.github.com/repos/${REPO}/contents/equipos.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Partido: ${local} ${golesLocal}-${golesVisitante} ${visitante}`,
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(equipos, null, 2)))),
                        sha: data.sha,
                        branch: BRANCH
                    })
                });

                mostrarStatus('status-partido', '‚úÖ Partido registrado correctamente', 'success');
                e.target.reset();
            } catch (error) {
                mostrarStatus('status-partido', '‚ùå Error al registrar partido', 'error');
                console.error(error);
            }
        });

        // REGISTRAR GOLEADOR
        document.getElementById('goleador-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const nombre = document.getElementById('nombre-goleador').value.trim();
            const equipo = document.getElementById('equipo-goleador').value;
            const goles = parseInt(document.getElementById('cantidad-goles').value);

            try {
                const response = await fetch(`https://api.github.com/repos/${REPO}/contents/goleadores.json?ref=${BRANCH}`, {
                    headers: { 'Authorization': `token ${TOKEN}` }
                });
                const data = await response.json();
                let goleadores = JSON.parse(atob(data.content));

                const existente = goleadores.find(g => g.nombre === nombre && g.equipo === equipo);
                if (existente) {
                    existente.goles += goles;
                } else {
                    goleadores.push({ nombre, equipo, goles });
                }

                goleadores.sort((a, b) => b.goles - a.goles);

                await fetch(`https://api.github.com/repos/${REPO}/contents/goleadores.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Goleador: ${nombre} (${equipo}) +${goles} goles`,
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(goleadores, null, 2)))),
                        sha: data.sha,
                        branch: BRANCH
                    })
                });

                mostrarStatus('status-goleador', '‚úÖ Goleador registrado correctamente', 'success');
                e.target.reset();
            } catch (error) {
                mostrarStatus('status-goleador', '‚ùå Error al registrar goleador', 'error');
                console.error(error);
            }
        });

        function mostrarStatus(id, mensaje, tipo) {
            const el = document.getElementById(id);
            el.textContent = mensaje;
            el.className = `status-message ${tipo}`;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 4000);
        }
    </script>
</body>
</html>
